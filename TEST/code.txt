;====================================================================
; Main.asm file generated by New Project wizard
;
; Created:   Sat Apr 20 2024
; Processor: AT89C51
; Compiler:  ASEM-51 (Proteus)
;====================================================================

$NOMOD51
$INCLUDE (8051.MCU)

;====================================================================
; DEFINITIONS
;====================================================================

;====================================================================
; VARIABLES
;====================================================================

;====================================================================
; RESET and INTERRUPT VECTORS
;====================================================================

      ; Reset Vector
      org   0000h
      jmp   Start
      ORG	000BH
      LJMP T0_ISR
      

;====================================================================
; CODE SEGMENT
;====================================================================
DELAY:
      MOV	R7, #255
      DL1:
	    DJNZ	R7, DL1
RET
      org   0100h
Start:	
      MOV TMOD, #09H
      MOV TH0, #0EEH
      MOV TL0, #06H
      MOV IE, #87H
      SETB TR0
      
      MOV R0, #0 ; CHU KÃŒ
      MOV R1, #7 ; GIAY 7-3-10
      MOV R2, #1
      CLR P3.7
Loop:	
      SETB	P3.1
      MOV	A, R1
      MOV	B, #0AH
      DIV	AB
      MOV	P0, B
      CALL DELAY
      CLR	P3.1
      SETB	P3.0
      MOV	P0, A
      CALL DELAY
      CLR	P3.0
      jmp Loop


T0_ISR:
      CPL	P1.0
      MOV TH0, #0EEH
      MOV TL0, #06H
      SETB TR0
      INC R0
      CJNE R0, #200, END_T0_ISR
      GIAY: 
	    DEC R1
	    MOV	R0, #0 
	    XANH:
	       CJNE R2, #1, VANG
	       CJNE R1, #0, CON_X
		  MOV R1, #3
		  INC R2
		  JMP VANG
	       CON_X:
	       CLR P3.7
	       SETB P3.5
	       SETB P3.6
	    VANG:
	       CJNE R2, #2, DO
	       CJNE R1, #0, CON_V
		  MOV R1, #10
		  INC R2
		  JMP DO
	       CON_V:
	       CLR P3.6
	       SETB P3.5
	       SETB P3.7
	    DO:
	       CJNE R2, #3, END_T0_ISR
	       CJNE R1, #0, CON_DO
		  MOV R1, #7
		  MOV R2, #1
		  CLR P3.7
		  JMP END_T0_ISR
	       CON_DO:
	       CLR P3.5
	       SETB P3.7
	       SETB P3.6
	    
	    
      END_T0_ISR:
RETI
      
;====================================================================
      END